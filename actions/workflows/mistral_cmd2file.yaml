version: '2.0'

st2_utils.mistral_cmd2file:
    description: A basic workflow that runs an arbitrary linux command.
    type: direct
    input:
        - cmd
        - hosts
        - username
        - password
        - timeout
    output:
        stdout: <% $.stdout %>
    tasks:
        run_cmd:
            action: core.local cmd="echo task1:run_cmd"
            publish:
                stdout: <% task(run_cmd).result.stdout %>
                stderr: <% task(run_cmd).result.stderr %>
            on-success:
                - cmd2file 
            on-error:
                - notify           
        cmd2file:
            action: core.local cmd="echo <% task(run_cmd).result.stdout %> >> ~/st2_utils.cmd-success.out"
            publish:
                stdout: <% task(cmd2file).result.stdout %>
                stderr: <% task(cmd2file).result.stderr %>  
        notify:
            action: core.local
            input:
                cmd: "printf '<% $.status_message %>'"          